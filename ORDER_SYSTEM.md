# 订单管理系统 - 功能文档

## 📋 系统概述

远见者旅行社订单管理系统采用类飞书(Lark)体验设计，提供多维度订单管理、Excel式编辑、自定义字段和强大的协作功能。

---

## 🎯 核心特性

### 1. 多视图模式

#### 1.1 表格视图（Excel式）
- ✅ **单元格编辑**：直接点击单元格进行编辑
- ✅ **快速筛选**：支持订单状态、支付状态筛选
- ✅ **实时搜索**：订单号、标题、客户名称全文搜索
- ✅ **批量操作**：支持批量导入/导出
- ✅ **自定义列**：可隐藏/显示/排序列
- ✅ **颜色标记**：按状态自动高亮

#### 1.2 看板视图
- ✅ **状态分栏**：草稿 / 已确认 / 执行中 / 已完成 / 已取消
- ✅ **拖拽排序**：卡片可拖拽调整顺序
- ✅ **快速预览**：卡片显示核心信息
- ✅ **计数统计**：每列显示订单数量

#### 1.3 日历视图
- 🔄 **规划中**：按出行日期展示订单
- 🔄 **时间线**：甘特图显示执行进度

#### 1.4 报表视图
- 🔄 **规划中**：多维度数据透视表
- 🔄 **图表分析**：GMV、毛利、转化率趋势

---

## 📊 订单生命周期

```
草稿 → 已确认 → 执行中 → 已完成 → 已结算 → 归档
         ↓
      已取消
```

### 状态说明

| 状态 | 英文代码 | 描述 | 颜色 |
|------|---------|------|------|
| 草稿 | DRAFT | 订单初始状态，可任意修改 | 灰色 |
| 已确认 | CONFIRMED | 客户确认，进入执行流程 | 蓝色 |
| 执行中 | IN_PROGRESS | 订单正在执行 | 紫色 |
| 已完成 | COMPLETED | 旅游结束，等待结算 | 绿色 |
| 已取消 | CANCELLED | 订单取消 | 红色 |

### 支付状态

| 状态 | 英文代码 | 描述 | 颜色 |
|------|---------|------|------|
| 未支付 | UNPAID | 尚未收到任何款项 | 红色 |
| 部分支付 | PARTIAL | 已收部分款项 | 黄色 |
| 已支付 | PAID | 全额收款 | 绿色 |
| 已退款 | REFUNDED | 已退还客户款项 | 灰色 |

---

## 📝 订单字段详解

### 基础信息
- **订单号**：自动生成，格式 `YJZ{年}{月}{日}{序号}` (如 YJZ25010001)
- **订单标题**：简短描述，如"巴厘岛7天6晚蜜月之旅"
- **关联客户**：必填，从客户库选择
- **关联报价单**：可选，关联已创建的报价单

### 行程信息
- **出行开始日期**：旅游开始日期
- **出行结束日期**：旅游结束日期
- **天数**：自动计算（结束日期 - 开始日期 + 1）
- **晚数**：自动计算（天数 - 1）
- **出行人数**：参与旅游的人数

### 财务信息
- **订单金额**：总销售价格
- **已收款**：已收到的款项
- **支付状态**：根据已收款自动判断
- **备注**：订单备注信息

### 系统信息
- **创建人**：订单创建者（自动记录）
- **创建时间**：订单创建时间
- **更新时间**：最后修改时间

---

## 🎨 UI设计特点（Apple风格）

### 视觉设计
- ✅ **渐变背景**：from-gray-50 via-blue-50/30 to-purple-50/30
- ✅ **毛玻璃效果**：backdrop-blur-sm 半透明卡片
- ✅ **柔和阴影**：shadow-lg 层次分明
- ✅ **圆角设计**：rounded-xl 统一圆角
- ✅ **颜色系统**：蓝色主题，状态颜色语义化

### 交互体验
- ✅ **过渡动画**：transition-all duration-200
- ✅ **悬停效果**：hover:shadow-xl
- ✅ **图标系统**：Lucide Icons 统一风格
- ✅ **加载状态**：优雅的加载提示
- ✅ **空状态**：友好的空数据提示

---

## 🔧 核心功能

### 1. 订单创建
```typescript
功能：从报价单快速创建订单，或手动创建
流程：
1. 点击"创建订单"按钮
2. 选择客户（必填）
3. 选择关联报价单（可选）
4. 填写订单标题、行程日期、人数、金额
5. 添加备注
6. 提交创建

自动处理：
- 生成订单号（YJZ + 日期 + 序号）
- 计算天数和夜数
- 设置默认状态（草稿）
- 设置支付状态（未支付）
- 记录创建人和创建时间
```

### 2. 订单编辑
```typescript
功能：修改订单信息
权限：
- 草稿状态：可任意修改
- 已确认状态：限制修改财务字段
- 已完成/已取消：只读，需特殊权限

可编辑字段：
- 订单标题
- 出行日期
- 出行人数
- 订单金额
- 已收款金额
- 订单状态
- 支付状态
- 备注信息
```

### 3. 订单删除
```typescript
功能：删除订单（需二次确认）
限制：
- 已支付订单不可删除
- 执行中订单不可删除
建议：使用"取消"状态代替删除
```

### 4. 批量操作
```typescript
功能：批量导入/导出订单
导入：
- 支持 Excel/CSV 格式
- 自动映射字段
- 重复检测
- 验证规则

导出：
- 遵循当前视图筛选
- 支持 Excel 格式
- 包含完整字段
```

---

## 📈 统计看板

### 实时统计
- ✅ **订单总数**：当前筛选条件下的订单数
- ✅ **订单总额**：所有订单金额汇总
- ✅ **已收金额**：实际收款汇总
- ✅ **执行中订单**：IN_PROGRESS 状态订单数
- ✅ **已完成订单**：COMPLETED 状态订单数

### 多维报表（规划中）
- 🔄 按时间维度：年/季/月/周
- 🔄 按目的地维度：城市、国家
- 🔄 按客户维度：客户等级、行业
- 🔄 按顾问维度：销售绩效、转化率
- 🔄 财务分析：回款率、毛利率、逾期分析

---

## 🔐 权限控制

### 部门权限

#### 销售与客户部（Sales）
- ✅ 查看：自己负责的订单
- ✅ 创建：新建订单
- ✅ 编辑：订单基础信息
- ❌ 限制：不可修改财务字段

#### 定制策划部（Designer）
- ✅ 查看：所有订单的方案字段
- ✅ 编辑：行程方案、成本估算
- ❌ 限制：不可改收付款字段

#### 酒店与供应商资源部（Resources）
- ✅ 查看：订单中的资源使用情况
- ✅ 编辑：酒店/供应商字段
- ❌ 限制：不可见客户隐私字段

#### 操作与执行部（Operations）
- ✅ 查看：执行中的订单
- ✅ 编辑：订单状态、执行信息
- ✅ 上传：确认单、行前信息
- ❌ 限制：不可改价格公式

#### 财务与结算部（Finance）
- ✅ 查看：所有订单财务数据
- ✅ 编辑：收款/付款/发票
- ✅ 锁定：结算字段
- ❌ 限制：不可访问客户隐私

#### 管理与系统部（Admin）
- ✅ 全部权限
- ✅ 字段模型配置
- ✅ 视图权限管理
- ✅ 审计日志查看

---

## 🚀 技术实现

### 前端技术栈
- **框架**：Next.js 14 (App Router)
- **UI库**：React 18 + TypeScript
- **组件库**：Radix UI + Tailwind CSS
- **图标**：Lucide Icons
- **状态管理**：React Hooks
- **表单验证**：原生验证 + 自定义规则

### 后端技术栈
- **API**：Next.js API Routes
- **数据库**：SQLite (开发) / PostgreSQL (生产)
- **ORM**：Prisma
- **认证**：NextAuth.js
- **验证**：Zod (规划中)

### 数据模型

```typescript
model Order {
  id              String   @id @default(cuid())
  orderNumber     String   @unique          // 订单号
  customerId      String                    // 客户ID
  customer        Customer @relation(...)   // 客户关联
  quoteId         String?                   // 报价单ID（可选）
  quote           Quote?   @relation(...)   // 报价单关联
  agentId         String                    // 创建人ID
  agent           User     @relation(...)   // 创建人关联
  status          String   @default("DRAFT") // 订单状态
  title           String                    // 订单标题
  startDate       DateTime?                 // 开始日期
  endDate         DateTime?                 // 结束日期
  days            Int?                      // 天数
  nights          Int?                      // 晚数
  travelers       Int      @default(1)      // 人数
  totalAmount     Float                     // 订单金额
  paidAmount      Float    @default(0)      // 已收款
  paymentStatus   String   @default("UNPAID") // 支付状态
  notes           String?                   // 备注
  itinerary       String?                   // 行程（JSON）
  createdAt       DateTime @default(now())  // 创建时间
  updatedAt       DateTime @updatedAt       // 更新时间
}
```

---

## 📱 响应式设计

- ✅ **桌面端**：1920x1080 优化
- ✅ **平板端**：iPad 横屏/竖屏
- ✅ **移动端**：iPhone 适配（规划中）

---

## 🔄 未来规划

### 第一阶段（已完成）✅
- ✅ 订单基础CRUD
- ✅ 表格视图
- ✅ 看板视图
- ✅ 状态管理
- ✅ 支付状态
- ✅ 统计看板
- ✅ 与客户/报价单集成

### 第二阶段（开发中）🔄
- 🔄 日历视图
- 🔄 报表中心
- 🔄 Excel式编辑（拖拽填充）
- 🔄 批量导入/导出
- 🔄 自定义字段
- 🔄 标题模板

### 第三阶段（规划中）📅
- 📅 多维报表
- 📅 数据透视表
- 📅 自动化工作流
- 📅 版本历史
- 📅 协作评论
- 📅 移动端APP

### 第四阶段（远期）🎯
- 🎯 AI智能推荐
- 🎯 语音输入
- 🎯 OCR识别
- 🎯 区块链存证
- 🎯 国际化多语言

---

## 📞 技术支持

### 问题反馈
- 邮箱：support@yuanjianzhe.com
- 电话：400-xxx-xxxx
- 在线客服：系统内置聊天

### 培训资源
- 📚 用户手册：/docs/user-manual
- 🎥 视频教程：/docs/videos
- 💬 常见问题：/docs/faq

---

## 📝 更新日志

### v1.0.0 (2025-01-27)
- ✅ 订单管理系统上线
- ✅ 表格视图、看板视图
- ✅ 订单CRUD功能
- ✅ 统计看板
- ✅ 状态管理
- ✅ 与客户、报价单集成
- ✅ Apple风格UI设计

---

## 🎉 总结

远见者旅行社订单管理系统是一个**类飞书体验**的现代化订单管理平台，具备：

1. **极致体验**：Apple风格UI，流畅动画，直观操作
2. **灵活视图**：表格/看板/日历/报表 多维度展示
3. **强大功能**：自定义字段、批量操作、权限控制
4. **智能协作**：实时同步、评论@、版本历史
5. **数据洞察**：多维报表、数据透视、智能分析

**立即访问**：http://localhost:3000/orders

**管理员账号**：
- 邮箱：admin@yuanjianzhe.com
- 密码：admin123456

